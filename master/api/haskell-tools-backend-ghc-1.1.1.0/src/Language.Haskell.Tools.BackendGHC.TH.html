<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables, TypeApplications, TypeFamilies #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- | Functions that convert the Template-Haskell-related elements of the GHC AST to corresponding elements in the Haskell-tools AST representation</span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.TH</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Reader</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">asks</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ApiAnnotation</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AnnKeywordId</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpackFS</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsExpr</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsSplice</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HsBracket</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GHC</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsExtension</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GhcPass</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Decls.html"><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.Decls</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Decls.html#trfDecls"><span class="hs-identifier hs-var">trfDecls</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Decls.html#trfDeclsGroup"><span class="hs-identifier hs-var">trfDeclsGroup</span></a><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Exprs.html"><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.Exprs</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Exprs.html#trfExpr"><span class="hs-identifier hs-var">trfExpr</span></a><span class="hs-special">,</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Exprs.html#createScopeInfo"><span class="hs-identifier hs-var">createScopeInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Monad.html"><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.Monad</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Monad.html#TrfInput"><span class="hs-identifier hs-type">TrfInput</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Monad.html#Trf"><span class="hs-identifier hs-type">Trf</span></a><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Names.html"><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.Names</span></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Patterns.html"><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.Patterns</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Patterns.html#trfPattern"><span class="hs-identifier hs-var">trfPattern</span></a><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Types.html"><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.Types</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Types.html#trfType"><span class="hs-identifier hs-var">trfType</span></a><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html"><span class="hs-identifier">Language.Haskell.Tools.BackendGHC.Utils</span></a><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.Tools.AST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ann</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Dom</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RangeStage</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.Tools.AST</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">AST</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-identifier">trfQuasiQuotation'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679315982"><a href="#local-6989586621679315982"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679315983"><a href="#local-6989586621679315983"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Names.html#TransformName"><span class="hs-identifier hs-type">TransformName</span></a><span> </span><a href="#local-6989586621679315982"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679315983"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HsSplice</span><span> </span><a href="#local-6989586621679315982"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Monad.html#Trf"><span class="hs-identifier hs-type">Trf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AST.UQuasiQuote</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dom</span><span> </span><a href="#local-6989586621679315983"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">RangeStage</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span> </span><span class="hs-comment">-- the lexer does not provide us with tokens '[', '|' and '|]'</span><span>
</span><a name="line-26"></a><a name="trfQuasiQuotation%27"><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfQuasiQuotation%27"><span class="hs-identifier">trfQuasiQuotation'</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQuasiQuote</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679315984"><a href="#local-6989586621679315984"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621679315985"><a href="#local-6989586621679315985"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679315986"><a href="#local-6989586621679315986"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UQuasiQuote</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#annLocNoSema"><span class="hs-identifier hs-var">annLocNoSema</span></a><span> </span><a href="#local-6989586621679315987"><span class="hs-identifier hs-var">quoterLoc</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Names.html#trfName%27"><span class="hs-identifier hs-var">trfName'</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679315982"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679315984"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>                    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#annLocNoSema"><span class="hs-identifier hs-var">annLocNoSema</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679315988"><span class="hs-identifier hs-var">strLoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">AST.QQString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpackFS</span><span> </span><a href="#local-6989586621679315986"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- assume that there are no white spaces ain the head and the end of the quasi quote</span><span>
</span><a name="line-30"></a><span>        </span><a name="local-6989586621679315987"><a href="#local-6989586621679315987"><span class="hs-identifier">quoterLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679315989"><a href="#local-6989586621679315989"><span class="hs-identifier">rng</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">contRange</span><span>
</span><a name="line-31"></a><span>                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkSrcSpan</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateCol"><span class="hs-identifier hs-var">updateCol</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">srcSpanStart</span><span> </span><a href="#local-6989586621679315989"><span class="hs-identifier hs-var">rng</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateCol"><span class="hs-identifier hs-var">updateCol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">subtract</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">srcSpanStart</span><span> </span><a href="#local-6989586621679315985"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>        </span><a name="local-6989586621679315988"><a href="#local-6989586621679315988"><span class="hs-identifier">strLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkSrcSpan</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">srcSpanStart</span><span> </span><a href="#local-6989586621679315985"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateCol"><span class="hs-identifier hs-var">updateCol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">subtract</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">srcSpanEnd</span><span> </span><a href="#local-6989586621679315985"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-identifier">trfQuasiQuotation'</span><span> </span><a name="local-6989586621679315990"><a href="#local-6989586621679315990"><span class="hs-identifier">qq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#unhandledElement"><span class="hs-identifier hs-var">unhandledElement</span></a><span> </span><span class="hs-string">&quot;quasi quotation&quot;</span><span> </span><a href="#local-6989586621679315990"><span class="hs-identifier hs-var">qq</span></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-identifier">trfSplice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Names.html#TransformName"><span class="hs-identifier hs-type">TransformName</span></a><span> </span><a href="#local-6989586621679315979"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679315980"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">n</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621679315981"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HsSplice</span><span> </span><a href="#local-6989586621679315979"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Monad.html#Trf"><span class="hs-identifier hs-type">Trf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ann</span><span> </span><span class="hs-identifier hs-type">AST.USplice</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dom</span><span> </span><a href="#local-6989586621679315980"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">RangeStage</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><a name="trfSplice"><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfSplice"><span class="hs-identifier">trfSplice</span></a></a><span> </span><a name="local-6989586621679315991"><a href="#local-6989586621679315991"><span class="hs-identifier">spls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679315992"><a href="#local-6989586621679315992"><span class="hs-identifier">rng</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">contRange</span><span>
</span><a name="line-37"></a><span>                    </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#annLocNoSema"><span class="hs-identifier hs-var">annLocNoSema</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.TH.html#getSpliceLoc"><span class="hs-identifier hs-var">getSpliceLoc</span></a><span> </span><a href="#local-6989586621679315991"><span class="hs-identifier hs-var">spls</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679315992"><span class="hs-identifier hs-var">rng</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfSplice%27"><span class="hs-identifier hs-var">trfSplice'</span></a><span> </span><a href="#local-6989586621679315991"><span class="hs-identifier hs-var">spls</span></a><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-identifier">getSpliceLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsSplice</span><span> </span><a href="#local-6989586621679315978"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span>
</span><a name="line-40"></a><a name="getSpliceLoc"><a href="Language.Haskell.Tools.BackendGHC.TH.html#getSpliceLoc"><span class="hs-identifier">getSpliceLoc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTypedSplice</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679315993"><a href="#local-6989586621679315993"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621679315993"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-41"></a><span class="hs-identifier">getSpliceLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsUntypedSplice</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679315994"><a href="#local-6989586621679315994"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621679315994"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-42"></a><span class="hs-identifier">getSpliceLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQuasiQuote</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679315995"><a href="#local-6989586621679315995"><span class="hs-identifier">sp</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679315995"><span class="hs-identifier hs-var">sp</span></a><span>
</span><a name="line-43"></a><span class="hs-identifier">getSpliceLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSpliced</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noSrcSpan</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-identifier">trfSplice'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Names.html#TransformName"><span class="hs-identifier hs-type">TransformName</span></a><span> </span><a href="#local-6989586621679315975"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679315976"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">n</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621679315977"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HsSplice</span><span> </span><a href="#local-6989586621679315975"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Monad.html#Trf"><span class="hs-identifier hs-type">Trf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AST.USplice</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dom</span><span> </span><a href="#local-6989586621679315976"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">RangeStage</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><a name="trfSplice%27"><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfSplice%27"><span class="hs-identifier">trfSplice'</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTypedSplice</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679315996"><a href="#local-6989586621679315996"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfSpliceExpr"><span class="hs-identifier hs-var">trfSpliceExpr</span></a><span> </span><a href="#local-6989586621679315996"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-47"></a><span class="hs-identifier">trfSplice'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsUntypedSplice</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679315997"><a href="#local-6989586621679315997"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfSpliceExpr"><span class="hs-identifier hs-var">trfSpliceExpr</span></a><span> </span><a href="#local-6989586621679315997"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-48"></a><span class="hs-identifier">trfSplice'</span><span> </span><a name="local-6989586621679315998"><a href="#local-6989586621679315998"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#unhandledElement"><span class="hs-identifier hs-var">unhandledElement</span></a><span> </span><span class="hs-string">&quot;splice&quot;</span><span> </span><a href="#local-6989586621679315998"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">-- | TODO: easier with splice decoration</span><span>
</span><a name="line-51"></a><span class="hs-identifier">trfSpliceExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679315972"><a href="#local-6989586621679315972"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679315973"><a href="#local-6989586621679315973"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679315974"><a href="#local-6989586621679315974"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Names.html#TransformName"><span class="hs-identifier hs-type">TransformName</span></a><span> </span><a href="#local-6989586621679315972"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679315973"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">n</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621679315974"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsExpr</span><span> </span><a href="#local-6989586621679315972"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Monad.html#Trf"><span class="hs-identifier hs-type">Trf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AST.USplice</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dom</span><span> </span><a href="#local-6989586621679315973"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">RangeStage</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><a name="trfSpliceExpr"><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfSpliceExpr"><span class="hs-identifier">trfSpliceExpr</span></a></a><span> </span><a name="local-6989586621679315999"><a href="#local-6989586621679315999"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-53"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679316000"><a href="#local-6989586621679316000"><span class="hs-identifier">hasDollar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#allTokenLoc"><span class="hs-identifier hs-var">allTokenLoc</span></a><span> </span><span class="hs-identifier hs-var">AnnThIdSplice</span><span>
</span><a name="line-54"></a><span>     </span><a name="local-6989586621679316001"><a href="#local-6989586621679316001"><span class="hs-identifier">hasDoubleDollar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#allTokenLoc"><span class="hs-identifier hs-var">allTokenLoc</span></a><span> </span><span class="hs-identifier hs-var">AnnThIdTySplice</span><span>
</span><a name="line-55"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679316002"><a href="#local-6989586621679316002"><span class="hs-identifier">newSp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679316000"><span class="hs-identifier hs-var">hasDollar</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679316001"><span class="hs-identifier hs-var">hasDoubleDollar</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-56"></a><span>                   </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621679315999"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-57"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateStart"><span class="hs-identifier hs-var">updateStart</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateCol"><span class="hs-identifier hs-var">updateCol</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621679315999"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>                   </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateStart"><span class="hs-identifier hs-var">updateStart</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateCol"><span class="hs-identifier hs-var">updateCol</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621679315999"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679315999"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsVar</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316003"><a href="#local-6989586621679316003"><span class="hs-identifier">varName</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">AST.UIdSplice</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Names.html#trfName"><span class="hs-identifier hs-var">trfName</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679315972"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621679316002"><span class="hs-identifier hs-var">newSp</span></a><span> </span><a href="#local-6989586621679316003"><span class="hs-identifier hs-var">varName</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>                  </span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFld</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316004"><a href="#local-6989586621679316004"><span class="hs-identifier">fldName</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">AST.UIdSplice</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Names.html#trfAmbiguousFieldName%27"><span class="hs-identifier hs-var">trfAmbiguousFieldName'</span></a><span> </span><a href="#local-6989586621679316002"><span class="hs-identifier hs-var">newSp</span></a><span> </span><a href="#local-6989586621679316004"><span class="hs-identifier hs-var">fldName</span></a><span>
</span><a name="line-61"></a><span>                  </span><a name="local-6989586621679316005"><a href="#local-6989586621679316005"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">AST.UParenSplice</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Exprs.html#trfExpr"><span class="hs-identifier hs-var">trfExpr</span></a><span> </span><a href="#local-6989586621679316005"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-identifier">trfBracket'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679315969"><a href="#local-6989586621679315969"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679315970"><a href="#local-6989586621679315970"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679315971"><a href="#local-6989586621679315971"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Names.html#TransformName"><span class="hs-identifier hs-type">TransformName</span></a><span> </span><a href="#local-6989586621679315969"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679315970"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">n</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621679315971"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HsBracket</span><span> </span><a href="#local-6989586621679315969"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Monad.html#Trf"><span class="hs-identifier hs-type">Trf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AST.UBracket</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dom</span><span> </span><a href="#local-6989586621679315970"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">RangeStage</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><a name="trfBracket%27"><a href="Language.Haskell.Tools.BackendGHC.TH.html#trfBracket%27"><span class="hs-identifier">trfBracket'</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExpBr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316006"><a href="#local-6989586621679316006"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UExprBracket</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Exprs.html#trfExpr"><span class="hs-identifier hs-var">trfExpr</span></a><span> </span><a href="#local-6989586621679316006"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-65"></a><span class="hs-identifier">trfBracket'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TExpBr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316007"><a href="#local-6989586621679316007"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UExprBracket</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Exprs.html#trfExpr"><span class="hs-identifier hs-var">trfExpr</span></a><span> </span><a href="#local-6989586621679316007"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-66"></a><span class="hs-identifier">trfBracket'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarBr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316008"><a href="#local-6989586621679316008"><span class="hs-identifier">isSingle</span></a></a><span> </span><a name="local-6989586621679316009"><a href="#local-6989586621679316009"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UExprBracket</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#annLoc"><span class="hs-identifier hs-var">annLoc</span></a><span> </span><a href="Language.Haskell.Tools.BackendGHC.Exprs.html#createScopeInfo"><span class="hs-identifier hs-var">createScopeInfo</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateStart"><span class="hs-identifier hs-var">updateStart</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#updateCol"><span class="hs-identifier hs-var">updateCol</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679316008"><span class="hs-identifier hs-var">isSingle</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">contRange</span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.UVar</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Utils.html#annContNoSema"><span class="hs-identifier hs-var">annContNoSema</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.Tools.BackendGHC.Names.html#trfName%27"><span class="hs-identifier hs-var">trfName'</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679315969"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679316009"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-identifier">trfBracket'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatBr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316010"><a href="#local-6989586621679316010"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UPatternBracket</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Patterns.html#trfPattern"><span class="hs-identifier hs-var">trfPattern</span></a><span> </span><a href="#local-6989586621679316010"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-70"></a><span class="hs-identifier">trfBracket'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DecBrL</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316011"><a href="#local-6989586621679316011"><span class="hs-identifier">decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UDeclsBracket</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Decls.html#trfDecls"><span class="hs-identifier hs-var">trfDecls</span></a><span> </span><a href="#local-6989586621679316011"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-71"></a><span class="hs-identifier">trfBracket'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DecBrG</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316012"><a href="#local-6989586621679316012"><span class="hs-identifier">decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UDeclsBracket</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Decls.html#trfDeclsGroup"><span class="hs-identifier hs-var">trfDeclsGroup</span></a><span> </span><a href="#local-6989586621679316012"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-72"></a><span class="hs-identifier">trfBracket'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypBr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679316013"><a href="#local-6989586621679316013"><span class="hs-identifier">typ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.UTypeBracket</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.Haskell.Tools.BackendGHC.Types.html#trfType"><span class="hs-identifier hs-var">trfType</span></a><span> </span><a href="#local-6989586621679316013"><span class="hs-identifier hs-var">typ</span></a><span>
</span><a name="line-73"></a></pre></body></html>